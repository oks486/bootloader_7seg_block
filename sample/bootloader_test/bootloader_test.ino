/*
  bootloader_test.ino
  oaks@oks486
 */


char str[] = "0123456789ABCDEF"; 

char command_write[] = {0xaa,0x55,0xaa,0xff,0xaa}; 
char command_exec[] = {0xaa,0x55,0xaa,0x00,0x55}; 

char user_program[] = "\
:10000000FF3F0528FF3FFF3FFF3F0628200008284D\
:10001000FA017830210099001A1C0C283F3020008A\
:100020008C003F308E00043024008C0023008C01B3\
:100030008E01063021008C008E01843022009D004C\
:10004000903023009D0020309E009F0119309B00BE\
:100050002000911E282823001908F7007708F900CE\
:1000600079089A005428303020008C001F30522824\
:10007000303020008C003E305228303020008C0080\
:100080003D305228303020008C002F305228303044\
:1000900020008C003730522820304F28303020008C\
:1000A0008C003F308E006F280630F0000030F100E9\
:1000B0007A08F700F8017708F2007808F300792051\
:1000C0007108003A031965284E287008840006302C\
:1000D000040203184E288031C0300407820001302A\
:1000E000F7007708FA0706307A02031C2828FA017D\
:1000F0002828F601F31F8328F209F309F20A0319ED\
:10010000F30AF601F60AF11F8A28F009F109F00A4C\
:100110000319F10A710870040319B128F501F50AF1\
:10012000F11B9C280130F035F10D890B932801302B\
:10013000F4007408F507902871087302031DA228C3\
:1001400070087202031CA8287008F2027108F33BC1\
:100150000130F136F00C890BA9280130F502031D9E\
:100160009C2876080319B928F209F309F20A031941\
:10017000F30A7308F101F1077208F001F0070800B3\
:10018000332838283D28422847284C28FF3FFF3F86\
:00000001FF\
";

void setup() {
  Serial.begin(9600);
  delay (1000);
}

void loop() {

  // send command for writing user program
  for (int i = 0; i < sizeof(command_write); i++){
    Serial.write(command_write[i]);
  }
  delay(250);

  // write user program
  for (long i = 0; i < sizeof(user_program); i++){
    if (user_program[i] == ':') {
      delay(5);
    }
    Serial.write(user_program[i]);
  }

  // send command for running user program
  for (int i = 0; i < sizeof(command_exec); i++){
    Serial.write(command_exec[i]);
  }

  // display
  while(1) {
    for (int i = 0; i < sizeof(str) - 1; i++){
      Serial.write(str[i]);
      delay(100);
      Serial.write(str[i]);
      delay(100);
      Serial.write(0x0d);
      delay(100);
    }
  }

}

